圖片文字修改專家 (Image Text Editor Expert) - v13.0 系統規格書

版本: v13.0
發布日期: 2026/01/25
技術架構: HTML5 Canvas + Vanilla JavaScript + Tailwind CSS
儲存機制: IndexedDB (瀏覽器本地資料庫)

1. 系統概述

本系統為一款基於瀏覽器的輕量級圖片編輯工具，專注於「圖片文字修改」、「去背」與「物件管理」。使用者可上傳圖片，透過框選區域進行 OCR 文字辨識、智慧去背截圖或直接消除內容，並可疊加新的文字、色塊或 QR Code 進行二次編輯。

2. 核心技術棧

核心語言: Native JavaScript (ES6+)

渲染引擎: HTML5 <canvas> (2D Context)

樣式框架: Tailwind CSS (CDN)

外部函式庫:

tesseract.js (v5): 用於 OCR 文字辨識 (支援繁中/英文)。

qrcode.js: 用於生成 QR Code。

font-awesome: UI 圖示。

3. 功能模組詳解

3.1 畫布操作 (Canvas Operations)

圖片載入: 支援拖曳或點擊按鈕上傳圖片，載入時自動適應視窗大小置中。

視圖控制:

縮放 (Zoom): 支援滑鼠滾輪 (無須按鍵) 或介面按鈕縮放 (範圍 0.1x ~ 5.0x)。

平移 (Pan):

使用「抓手工具」拖曳。

或按住滑鼠拖曳畫布背景區域。

或按住 Space 鍵 (視瀏覽器預設行為而定，目前主要透過工具切換)。

重置視角 (Reset View): 一鍵將圖片縮放至適合視窗大小並置中。

座標系統: 採用 transform-origin: 0 0 與 Math.floor 強制整數運算，確保在高解析度螢幕或縮放狀態下，點擊判定 (Hit Test) 精準無誤。

3.2 工具箱 (Toolbar)

工具名稱

圖示

功能描述

游標樣式

選取 (Select)

↖

預設工具。可點選物件進行拖曳、縮放；或在空白處拖曳畫出「紅色選取框」。

Default / Move

平移 (Hand)

✋

鎖定為平移模式，拖曳畫面任何位置皆移動視圖。

Grab

色塊 (Rect)

⬜

拖曳滑鼠建立一個純色矩形區塊 (ColorBlock)，預設顏色為淺灰。

Crosshair

縮放控制

🔍

放大、縮小、還原視角按鈕。

-

3.3 選取區域動作 (Context Actions)

當使用者在畫布上畫出「紅色選取框」後，可執行以下動作：

辨識文字 (OCR)

邏輯: 截取框內影像 -> Tesseract.js 辨識 -> 取得文字。

後處理:

自動偵測框框邊緣顏色，建立一個 Patch (補丁) 蓋住原位置。

建立一個 TextBlock (文字框)，內容為辨識結果。

文字框自動調整大小以容納文字，並自動選取該文字框以利後續編輯。

字型: 預設 Noto Sans TC，粗體。

智能去背 (Smart/Magic Crop)

邏輯:

截取框內影像。

背景偵測: 掃描截圖的四個邊框，計算直方圖 (Histogram) 找出優勢背景色 (Dominant Color)。

原圖修補: 用偵測到的背景色建立 Patch 蓋住原圖。

去背運算: 使用 Flood Fill (邊緣擴散法)。從截圖的四個角落與邊框開始，向內搜尋顏色差異小於 Tolerance (預設 50) 的像素並轉為透明。

物件生成: 將去背後的圖片轉為 ImageBlock 物件，浮在畫布上可自由移動。

圈選消除 (Erase Selection)

邏輯: 偵測選取框邊緣的優勢背景色，直接建立一個純色 Patch 蓋住該區域。

用途: 快速去除浮水印、雜物或舊文字，保留背景底色。

3.4 物件編輯屬性 (Properties Panel)

根據選取的物件類型，右側欄位會顯示不同選項：

A. 文字物件 (Text Block)

內容: 多行文字編輯。

樣式: 字型 (黑體/明體/Arial)、字重 (粗/細)、大小 (px)、顏色 (含 HEX 顯示)。

排版: 對齊 (左/中/右)、行高、字距、內距 (Padding)。

背景: 勾選後可設定文字框背景色 (支援滴管吸色)。

互動: 支援右下角手柄拖曳縮放字體大小。

B. 圖片物件 (Image Block) - 由去背或 QR Code 產生

縮放: 滑桿控制縮放比例 (0.1 ~ 5.0)。

吸色去背 (Pick & Remove):

開啟後游標變為魔術棒。

點擊圖片上的顏色，以點擊點為種子，進行 Flood Fill (擴散去背)。

搭配 容許值 (Tolerance) 滑桿使用，數值越大去除範圍越廣。

C. 色塊物件 (Color Block)

顏色: 設定填充顏色 (支援滴管吸色)。

互動: 支援右下角手柄改變寬高。

3.5 進階系統功能

復原/重做 (Undo/Redo)

機制: 狀態快照 (State Snapshot)。

深度: 記錄最近 20 步操作。

觸發: 每次放開滑鼠 (MouseUp)、屬性變更 (Change)、物件建立時自動記錄。

快捷鍵: Ctrl+Z (Undo), Ctrl+Y 或 Ctrl+Shift+Z (Redo)。

自動存檔 (Auto-Save)

儲存: 使用 IndexedDB (ImageTextEditorDB_v11) 儲存完整專案狀態 (圖片 Base64 + 所有物件 JSON)。

頻率: 每 20 秒自動儲存一次，或手動按 Ctrl+S。

載入: 重新整理頁面時，若偵測到有未完成的存檔，會跳出詢問視窗。

匯出 (Export)

將目前的 Canvas 畫面 (含原圖、補丁、文字、物件) 合併渲染為一張 PNG 圖片下載。檔名格式：edit_{timestamp}.png。

4. 演算法細節備註

4.1 點擊判定 (Hit Test)

為了優化體驗，判定範圍設有 10px 的容錯值 (scaled)。

判定順序為反向 (Reverse Order)，確保優先選取最上層的物件。

拖曳優先權: 在 mousedown 事件中，一旦判定命中物件，立即鎖定 isDraggingItem = true，防止與「重新框選」邏輯衝突。

4.2 色彩距離計算

在去背邏輯中，使用 歐幾里得距離 (Euclidean Distance) 公式：


$$\text{Distance} = \sqrt{(R_1-R_2)^2 + (G_1-G_2)^2 + (B_1-B_2)^2}$$

若距離小於等於 Tolerance ^ 2 (平方比較以提升效能)，則視為相似顏色並去除。

4.3 游標管理

嚴格禁止使用 canvas.className = ... 覆寫類別，以免遺失 CSS 定位。

統一使用 canvas.style.cursor 或 canvas.classList.add/remove 進行游標切換 (如滴管、十字線、移動圖示)。

5. 快捷鍵列表

Ctrl + S: 手動暫存

Ctrl + Z: 復原

Ctrl + Y: 重做

滾輪: 縮放畫布

Esc: 取消「吸色去背」模式